function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();angular.module("volleyApp",["ui.router","angularCharts","ui.bootstrap"]).constant("_",window._),angular.module("volleyApp").config(["$stateProvider","$urlRouterProvider",function(a,b){"use strict";b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home"}).state("todo",{url:"/todo",templateUrl:"views/todo.html",controller:"TodoCtrl",controllerAs:"todo"}).state("histo",{url:"/histo",templateUrl:"views/history.html",controller:"HistoryCtrl",controllerAs:"history"}).state("stat",{url:"/histo/stat/:matchId",templateUrl:"views/stat.html",controller:"StatCtrl",controllerAs:"stat"}).state("match",{url:"/match",templateUrl:"views/match.html",controller:"MatchCtrl",controllerAs:"matchCtrl"})}]);var HomeCtrl=function a(){_classCallCheck(this,a),this.version="0.0.1"};angular.module("volleyApp").controller("HomeCtrl",HomeCtrl);var HistoCtrl=function(){function a(b,c){_classCallCheck(this,a),this.locale=b,this.matchsStorageService=c,this.matchForms={0:"aucun match sauvegardé",one:"{} match sauvegardé",other:"{} matchs sauvegardés"},this.matchs=c.getSavedMatchs()}return _createClass(a,[{key:"clearMatchs",value:function(){this.matchsStorageService.clearSavedMatch(),this.matchs=[]}},{key:"removeMatch",value:function(a){this.matchsStorageService.removeSavedMatch(a),this.matchs=this.matchsStorageService.getSavedMatchs()}}]),a}();angular.module("volleyApp").controller("HistoryCtrl",["$locale","matchsStorageService",HistoCtrl]);var MatchCtrl=function(){function a(b,c,d){_classCallCheck(this,a),this.window=b,this.matchsStorageService=c,this.matchService=d,this.match=this.matchService.getMatch(),this.match.isMatchStarted||(this.match.team1Name=this.matchsStorageService.getTeamName(1),this.match.team2Name=this.matchsStorageService.getTeamName(2))}return _createClass(a,[{key:"startGame",value:function(){this.startMatchForm.$valid&&(this.matchService.startGame(),this.matchsStorageService.saveTeamName(1,this.match.team1Name),this.matchsStorageService.saveTeamName(2,this.match.team2Name))}},{key:"addPoint",value:function(a){this.matchService.addPoint(a)}},{key:"newGame",value:function(){this.match=this.matchService.newGame()}},{key:"saveMatch",value:function(){var a={teams:{team1:this.match.team1Name,team2:this.match.team2Name},score:this.match.score};this.matchsStorageService.saveMatch(a),this.match.isMatchSaved=!0}},{key:"askTimeOut",value:function(a){1===a?this.match.timeOut1-=1:this.match.timeOut2-=1}}]),a}();angular.module("volleyApp").controller("MatchCtrl",["$window","matchsStorageService","MatchService",MatchCtrl]);var TodoCtrl=function b(){_classCallCheck(this,b),this.todos=["Retrieve point button","Reset","Technical TimeOut"]};angular.module("volleyApp").controller("TodoCtrl",TodoCtrl);var StatCtrl=function(){function a(b,c,d){_classCallCheck(this,a),this.$stateParams=b,this.matchsStorageService=c,this.statService=d,this.matchId=this.$stateParams.matchId,this.currentGame=this.matchsStorageService.getSavedMatch(this.matchId),this.currentSet=1,this.currentPoint=1,this.initTeamsStats(),this.diffCurrentSet=1}return _createClass(a,[{key:"nbSet",value:function(){return this.statService.nbSetsPlayed(this.currentGame.score)}},{key:"totalPoints",value:function(){return this.statService.totalPoints(this.currentGame.score)}},{key:"totalPointsWinForATeam",value:function(a){return this.statService.totalPointsWinForATeam(this.currentGame.score,a)}},{key:"getMaxConsecutivePointsForMatch",value:function(){return this.statService.getMaxConsecutivePointsForMatch(this.currentGame.score)}},{key:"initTeamsStats",value:function(){this.team1={name:this.currentGame.teams.team1,maxConsecutivesPoints:this.statService.getMaxConsecutivePointForTeam(this.currentGame,1),nbPointsWinOnService:this.statService.getNbPointsWinOnServiceForTeam(this.currentGame,1)},this.team2={name:this.currentGame.teams.team2,maxConsecutivesPoints:this.statService.getMaxConsecutivePointForTeam(this.currentGame,2),nbPointsWinOnService:this.statService.getNbPointsWinOnServiceForTeam(this.currentGame,2)}}},{key:"tmSetChanged",value:function(){this.currentPoint=this.currentGame.score[this.currentSet-1].length}},{key:"currentSetPoints",value:function(){return this.currentGame.score[this.currentSet-1].length}},{key:"currentSetScore",value:function(a){return this.currentGame.score[this.currentSet-1].slice(0,this.currentPoint).filter(function(b){return b===a}).length}},{key:"scoreDifferenceEvolution",value:function(){var a=this.currentGame.score[this.diffCurrentSet-1];this.maxDiff=this.statService.getSetMaxDifference(a)}}]),a}();angular.module("volleyApp").controller("StatCtrl",["$stateParams","matchsStorageService","StatService",StatCtrl]);var MatchsStorageService=function(){function a(b){_classCallCheck(this,a),this.storage=b.localStorage,this.matchsStorageName="ngMatchs",this.teamPrefixStorageName="Team"}return _createClass(a,[{key:"getTeamName",value:function(a){return this.storage&&this.storage.getItem(this.teamPrefixStorageName+a)?this.storage.getItem(this.teamPrefixStorageName+a):"Equipe "+a}},{key:"saveTeamName",value:function(a,b){this.storage&&this.storage.setItem(this.teamPrefixStorageName+a,b)}},{key:"saveMatch",value:function(a){var b;this.storage&&(b=angular.fromJson(this.storage.getItem(this.matchsStorageName))||[],b.push(a),this.storage.setItem(this.matchsStorageName,angular.toJson(b)))}},{key:"getSavedMatchs",value:function(){return this.storage?angular.fromJson(this.storage.getItem(this.matchsStorageName))||[]:void 0}},{key:"getSavedMatch",value:function(a){var b=this.getSavedMatchs();return b.length>=a?b[a]:null}},{key:"removeSavedMatch",value:function(a){if(this.storage){var b=this.getSavedMatchs();b.splice(a,1),this.storage.setItem(this.matchsStorageName,angular.toJson(b))}}},{key:"clearSavedMatch",value:function(){this.storage&&this.storage.removeItem(this.matchsStorageName)}}]),a}();angular.module("volleyApp").service("matchsStorageService",["$window",MatchsStorageService]);var StatService=function(){function a(b){_classCallCheck(this,a),this._=b}return _createClass(a,[{key:"getDifference",value:function(a){return this._.chain(a).transform(function(a,b,c,d){var e=1===b?1:-1;0===c?a.push(e):a.push(a[c-1]+e)}).unshift(0).value()}},{key:"getSetMaxDifference",value:function(a){return this._.max(this.getDifference(a))}},{key:"getMaxConsecutivePoints",value:function(a){return this._.chain(a).transform(function(a,b,c,d){c>0&&b===d[c-1]?a[a.length-1]++:a.push(1)}).max().value()}},{key:"getMaxConsecutivePointForTeam",value:function(a,b){return this._.chain(a.score).flatten().transform(function(a,c,d){d>0&&c===b?a[a.length-1]++:a.push(0)}).max().value()}},{key:"getNbPointsWinOnServiceForTeam",value:function(a,b){return a.score.map(function(c,d){return c.reduce(function(c,e,f,g){return 0===f&&e===b&&a.startService+d%2===b?c+=1:f>0&&e===b&&g[f-1]===b?c+=1:c},0)}).reduce(function(a,b){return b+a})}},{key:"getMaxConsecutivePointsForMatch",value:function(a){var b=this;return a.reduce(function(a,c){return Math.max(a,b.getMaxConsecutivePoints(c))},0)}},{key:"getMaxDifference",value:function(a){var b=this.getDifference(a);return b.reduce(function(a,b){return Math.abs(b)>Math.abs(a)?b:a})}},{key:"totalPoints",value:function(a){return this._(a).flatten().value().length}},{key:"totalPointsWinForATeam",value:function(a,b){return this._(a).flatten().filter(function(a){return a===b}).value().length}},{key:"nbSetsPlayed",value:function(a){return a.filter(function(a){return angular.isArray(a)&&a.length>0}).length}}]),a}();angular.module("volleyApp").service("StatService",["_",StatService]);var MatchService=function(){function a(){_classCallCheck(this,a),this.match=this.initGame()}return _createClass(a,[{key:"initGame",value:function(){return{currentSet:1,team1Name:"",team2Name:"",scoreTeam1:[0,0,0,0,0],scoreTeam2:[0,0,0,0,0],score:[[],[],[],[],[]],setWinTeam1:0,setWinTeam2:0,timeOut1:2,timeOut2:2,isMatchStarted:!1,isMatchOver:!1,isMatchSaved:!1,currentService:1,startService:1}}},{key:"newGame",value:function(){return this.match=this.initGame(),this.getMatch()}},{key:"getMatch",value:function(){return this.match}},{key:"startGame",value:function(){this.match.isMatchStarted=!0,this.match.currentService=this.match.startService}},{key:"addPoint",value:function(a){1===a?this.match.scoreTeam1[this.match.currentSet-1]+=1:this.match.scoreTeam2[this.match.currentSet-1]+=1,this.match.currentService=a,this.match.score[this.match.currentSet-1].push(a);var b=this.isSetOver();b&&(this.match.currentService=(this.match.startService+this.match.currentSet+1)%2+1,this.match.currentSet+=1,1===a?this.match.setWinTeam1+=1:this.match.setWinTeam2+=1,this.match.timeOut1=2,this.match.timeOut2=2,(3===this.match.setWinTeam1||3===this.match.setWinTeam2)&&(this.match.isMatchOver=!0,window.alert("Match terminé")))}},{key:"isTechinicalTimeOut",value:function(){if(5===this.match.currentSet)return!1;var a=Math.max(this.match.scoreTeam1[this.match.currentSet-1],this.match.scoreTeam2[this.match.currentSet-1]);return 8===a||16===a}},{key:"isSetOver",value:function(){var a=25;return 5===this.match.currentSet&&(a=15),(this.match.scoreTeam1[this.match.currentSet-1]>=a||this.match.scoreTeam2[this.match.currentSet-1]>=a)&&Math.abs(this.match.scoreTeam1[this.match.currentSet-1]-this.match.scoreTeam2[this.match.currentSet-1])>=2?!0:!1}}]),a}();angular.module("volleyApp").service("MatchService",MatchService);var MatchScore=function c(){_classCallCheck(this,c),this.templateUrl="views/directives/match-score.html",this.restrict="E",this.scope=!0,this.bindToController={match:"="},this.controllerAs="matchScore",this.controller=function(){return{scoreSets:function(a,b){return this.match.score[a].filter(function(a){return a===b}).length}}}};angular.module("volleyApp").directive("matchScore",function(){return new MatchScore});var NumSelect=function d(){_classCallCheck(this,d),this.templateUrl="views/directives/num-select.html",this.restrict="E",this.scope={nbOptions:"=",ngModel:"=",onChange:"&"},this.require="ngModel",this.link=function(a,b,c,d){a.num=[];var e=function(){var b=0;for(angular.isDefined(c.startAtOne)&&"true"===c.startAtOne&&(b=1),a.num=[];b<=a.nbOptions;b+=1)a.num.push(b)};a.$watch("nbOptions",function(){e()},!0),b.bind("change",function(){a.$apply(function(){a.onChange()})})}};angular.module("volleyApp").directive("numSelect",[function(){return new NumSelect}]);var SetEvolutionChart=function e(a){_classCallCheck(this,e),this.template='<div ac-chart="chartType" ac-data="data" ac-config="config"\nclass="chart" style="width: 90%; height:250px;"></div>',this.restrict="E",this.scope={set:"="},this.link=function(b,c){b.scoreDifferenceEvolution=function(){var c=a.getDifference(b.set),d=[];c.forEach(function(a,b,c){d.push({x:b,y:[a]})}),b.data={series:[""],data:d}},b.initEvolutionChart=function(){b.diffCurrentSet=1,b.data={series:[""],data:[]},b.chartType="line",b.config={labels:!1,title:"Evolution",legend:{display:!0,position:"right"},colors:["#3276b1"]},b.scoreDifferenceEvolution()},b.initEvolutionChart(),b.$watch("set",function(){b.scoreDifferenceEvolution()},!0)}};angular.module("volleyApp").directive("setEvolutionChart",["StatService",function(a){return new SetEvolutionChart(a)}]);var TeamStats=function f(){_classCallCheck(this,f),this.templateUrl="views/directives/team-stats.html",this.restrict="E",this.scope={stats:"="}};angular.module("volleyApp").directive("teamStats",function(){return new TeamStats}),angular.module("volleyApp").filter("service",function(){return function(a,b){return angular.isUndefined(b)?"":a===b?"S":""}});